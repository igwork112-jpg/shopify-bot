[phases.setup]
nixPkgs = [
    "python312",
    "chromium",
    "nss",
    "freetype",
    "harfbuzz",
    "ca-certificates",
    "fontconfig",
    "libjpeg62",
    "libjpeg_turbo",
    "zlib",
    "libpng",
    "libtiff",
    "libwebp",
    "openjpeg"
]

[phases.install]
cmds = [
    "pip install --upgrade pip",
    "pip uninstall -y Pillow",
    "pip install --no-cache-dir Pillow==10.2.0",
    "pip install -r requirements.txt",
    "playwright install chromium",
    "playwright install-deps chromium"
]

[phases.build]
cmds = ["echo 'Build complete'"]

[start]
cmd = "python app.py"

[env]
LD_LIBRARY_PATH = "/nix/store/*-libjpeg-turbo-*/lib:/nix/store/*-libjpeg-*/lib:$LD_LIBRARY_PATH"