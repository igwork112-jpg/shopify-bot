<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopify Review Bot - Control Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0f;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0;
            position: relative;
            overflow-x: hidden;
        }

        /* Navbar */
        .navbar {
            width: 100%;
            background: linear-gradient(180deg, #12121a 0%, #0a0a0f 100%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0 24px;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 700;
            color: #ff4d94;
        }

        .logo-icon {
            font-size: 24px;
        }

        .nav-links {
            display: flex;
            gap: 8px;
        }

        .nav-link {
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }

        .nav-link.active {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: #ffffff;
        }

        .main-content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
        }

        /* Animated background gradient */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(120, 0, 255, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(0, 255, 200, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(255, 0, 150, 0.05) 0%, transparent 70%);
            animation: bgPulse 8s ease-in-out infinite alternate;
            z-index: -1;
        }

        @keyframes bgPulse {
            0% {
                opacity: 0.8;
                transform: scale(1);
            }

            100% {
                opacity: 1;
                transform: scale(1.1);
            }
        }

        /* Floating particles effect */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(2px 2px at 20px 30px, rgba(255, 255, 255, 0.1), transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255, 255, 255, 0.05), transparent),
                radial-gradient(1px 1px at 90px 40px, rgba(255, 255, 255, 0.1), transparent),
                radial-gradient(2px 2px at 130px 80px, rgba(255, 255, 255, 0.05), transparent),
                radial-gradient(1px 1px at 160px 120px, rgba(255, 255, 255, 0.1), transparent);
            background-size: 200px 200px;
            animation: particleFloat 20s linear infinite;
            z-index: -1;
        }

        @keyframes particleFloat {
            0% {
                transform: translateY(0);
            }

            100% {
                transform: translateY(-200px);
            }
        }

        .container {
            background: rgba(20, 20, 30, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow:
                0 25px 80px rgba(0, 0, 0, 0.5),
                0 0 40px rgba(120, 0, 255, 0.1),
                inset 0 0 60px rgba(255, 255, 255, 0.02);
            max-width: 640px;
            width: 100%;
            padding: 45px;
            position: relative;
            overflow: hidden;
        }

        /* Glow border effect */
        .container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #7c3aed, #06b6d4, #7c3aed);
            border-radius: 26px;
            z-index: -1;
            opacity: 0.3;
            animation: borderGlow 3s ease-in-out infinite;
        }

        @keyframes borderGlow {

            0%,
            100% {
                opacity: 0.3;
            }

            50% {
                opacity: 0.5;
            }
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #ffffff;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffffff 0%, #a78bfa 50%, #06b6d4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .header p {
            color: rgba(255, 255, 255, 0.5);
            font-size: 15px;
            font-weight: 400;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1.2px;
        }

        .input-with-button {
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .input-with-button input {
            flex: 1;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group select {
            width: 100%;
            padding: 16px 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 15px;
            color: #ffffff;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #7c3aed;
            background: rgba(124, 58, 237, 0.1);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2), 0 0 20px rgba(124, 58, 237, 0.1);
        }

        .form-group select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgba(255,255,255,0.5)' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 50px;
        }

        .form-group select option {
            background: #1a1a2e;
            color: #ffffff;
            padding: 12px;
        }

        .btn-update {
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-update:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .btn-update:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn-update:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-update.success {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }

        .btn-update.success::before {
            content: "‚úì ";
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 18px;
            background: rgba(124, 58, 237, 0.1);
            border: 1px solid rgba(124, 58, 237, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checkbox-group:hover {
            background: rgba(124, 58, 237, 0.15);
            border-color: rgba(124, 58, 237, 0.3);
        }

        .checkbox-group input[type="checkbox"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #7c3aed;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            flex: 1;
            text-transform: none;
            letter-spacing: normal;
            color: rgba(255, 255, 255, 0.9);
        }

        .checkbox-group label small {
            color: rgba(255, 255, 255, 0.5);
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 35px;
        }

        .btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 14px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
            color: white;
            box-shadow: 0 8px 30px rgba(124, 58, 237, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(124, 58, 237, 0.5);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .status-box {
            margin-top: 30px;
            padding: 24px;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
        }

        .status-box.active {
            display: block;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status-box.running {
            border-color: rgba(16, 185, 129, 0.4);
            background: rgba(16, 185, 129, 0.1);
        }

        .status-box.error {
            border-color: rgba(239, 68, 68, 0.4);
            background: rgba(239, 68, 68, 0.1);
        }

        .status-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 18px;
            font-weight: 600;
            color: #ffffff;
            font-size: 16px;
        }

        .status-icon {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status-icon.running {
            background: #10b981;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.6);
            animation: statusPulse 1.5s infinite;
        }

        .status-icon.error {
            background: #ef4444;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.6);
        }

        @keyframes statusPulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }
        }

        .log-container {
            max-height: 280px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 16px;
            font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.7;
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .log-container::-webkit-scrollbar {
            width: 6px;
        }

        .log-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .log-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .log-entry {
            margin-bottom: 6px;
            padding: 4px 0;
        }

        .log-entry.info {
            color: #60a5fa;
        }

        .log-entry.success {
            color: #34d399;
        }

        .log-entry.error {
            color: #f87171;
        }

        .log-entry.warning {
            color: #fbbf24;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 36px;
            font-weight: 700;
            background: linear-gradient(135deg, #7c3aed, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 6px;
        }

        .help-text {
            color: rgba(255, 255, 255, 0.4);
            font-size: 12px;
            margin-top: 8px;
            font-style: normal;
        }

        .success-message {
            background: rgba(16, 185, 129, 0.15);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #34d399;
            padding: 12px 16px;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 13px;
            display: none;
        }

        .success-message.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="logo">
                <span class="logo-icon">üöÄ</span>
                <span>Shopify Automation</span>
            </div>
            <div class="nav-links">
                <a href="/dashboard" class="nav-link">Dashboard</a>
                <a href="/" class="nav-link active">Scrape</a>
            </div>
        </div>
    </nav>

    <div class="main-content">
        <div class="container">
            <div class="header">
                <h1>Review Bot Control Panel</h1>
                <p>Configure and run your Shopify review automation</p>
            </div>


            <div id="botForm">
                <div class="form-group">
                    <label>Store URL</label>
                    <div class="input-with-button">
                        <input type="text" id="storeUrl" placeholder="https://your-store.myshopify.com" required>
                        <button type="button" class="btn-update" id="updateUrlBtn">
                            Update
                        </button>
                    </div>
                    <div class="success-message" id="urlSuccessMsg">
                        ‚úì Store URL saved to configuration!
                    </div>
                    <p class="help-text">Enter your Shopify store URL and click Update</p>
                </div>

                <div class="form-group">
                    <label>OpenAI API Key</label>
                    <div class="input-with-button">
                        <input type="text" id="apiKey" placeholder="sk-proj-..." required>
                        <button type="button" class="btn-update" id="updateApiBtn">
                            Update
                        </button>
                    </div>
                    <div class="success-message" id="apiSuccessMsg">
                        ‚úì API Key saved to configuration!
                    </div>
                    <p class="help-text">Your OpenAI API key for AI review generation</p>
                </div>

                <div class="form-group">
                    <label>Gemini API Key</label>
                    <div class="input-with-button">
                        <input type="text" id="geminiApiKey" placeholder="AI...">
                        <button type="button" class="btn-update" id="updateGeminiApiBtn">
                            Update
                        </button>
                    </div>
                    <div class="success-message" id="geminiApiSuccessMsg">
                        ‚úì Gemini API Key saved to configuration!
                    </div>
                    <p class="help-text">Your Gemini API key for image generation (optional)</p>
                </div>

                <div class="form-group">
                    <label>üñºÔ∏è Image Generation Provider</label>
                    <select id="imageProvider">
                        <option value="gemini">Gemini 2.0 Flash (Fast & Free Tier)</option>
                        <option value="openai">OpenAI GPT-Image-1 (Premium Quality)</option>
                        <option value="none">None (No AI Images)</option>
                    </select>
                    <p class="help-text">Choose which AI provider to use for generating review images</p>
                </div>


                <div class="button-group">
                    <button type="button" class="btn btn-primary" id="startBtn">
                        <span id="startBtnIcon">üöÄ</span> <span id="startBtnText">Start Bot</span>
                    </button>
                    <button type="button" class="btn btn-secondary" id="stopBtn" disabled>
                        ‚èπÔ∏è Stop Bot
                    </button>
                </div>

                <div class="button-group" style="margin-top: 15px;">
                    <button type="button" class="btn btn-secondary" id="clearProgressBtn"
                        style="flex: none; padding: 12px 20px; font-size: 12px;">
                        üóëÔ∏è Clear Progress
                    </button>
                </div>
            </div>

            <div class="status-box" id="statusBox">
                <div class="status-header">
                    <div class="status-icon" id="statusIcon">‚óè</div>
                    <span id="statusText">Ready</span>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="statProducts">0</div>
                        <div class="stat-label">Products</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statReviews">0</div>
                        <div class="stat-label">Reviews Posted</div>
                    </div>
                </div>

                <div class="log-container" id="logContainer">
                    <div class="log-entry info">Bot ready to start...</div>
                </div>
            </div>
        </div>
    </div>

    <script>


        // Update Store URL
        const updateUrlBtn = document.getElementById('updateUrlBtn');
        const urlSuccessMsg = document.getElementById('urlSuccessMsg');

        updateUrlBtn.addEventListener('click', async function () {
            const storeUrl = document.getElementById('storeUrl').value.trim();

            if (!storeUrl) {
                alert('Please enter a store URL');
                return;
            }

            updateUrlBtn.disabled = true;
            updateUrlBtn.textContent = 'Updating...';

            try {
                const response = await fetch('/update-config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        field: 'STORE_URL',
                        value: storeUrl
                    })
                });

                const data = await response.json();

                if (data.success) {
                    updateUrlBtn.classList.add('success');
                    updateUrlBtn.textContent = 'Saved';
                    urlSuccessMsg.classList.add('show');

                    setTimeout(() => {
                        updateUrlBtn.classList.remove('success');
                        updateUrlBtn.textContent = 'Update';
                        urlSuccessMsg.classList.remove('show');
                    }, 3000);
                } else {
                    alert('Error: ' + data.message);
                    updateUrlBtn.textContent = 'Update';
                }
            } catch (error) {
                alert('Backend connection failed! Make sure Flask is running: python app.py');
                updateUrlBtn.textContent = 'Update';
            } finally {
                updateUrlBtn.disabled = false;
            }
        });

        // Update API Key
        const updateApiBtn = document.getElementById('updateApiBtn');
        const apiSuccessMsg = document.getElementById('apiSuccessMsg');

        updateApiBtn.addEventListener('click', async function () {
            const apiKey = document.getElementById('apiKey').value.trim();

            if (!apiKey) {
                alert('Please enter an API key');
                return;
            }

            updateApiBtn.disabled = true;
            updateApiBtn.textContent = 'Updating...';

            try {
                console.log('Updating API Key...');
                const response = await fetch('/update-config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        field: 'OPENAI_API_KEY',
                        value: apiKey
                    })
                });

                console.log('API Key update response status:', response.status);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('API Key update response data:', data);

                if (data.success) {
                    updateApiBtn.classList.add('success');
                    updateApiBtn.textContent = 'Saved';
                    apiSuccessMsg.classList.add('show');

                    setTimeout(() => {
                        updateApiBtn.classList.remove('success');
                        updateApiBtn.textContent = 'Update';
                        apiSuccessMsg.classList.remove('show');
                    }, 3000);
                } else {
                    alert('Error: ' + data.message);
                    updateApiBtn.textContent = 'Update';
                }
            } catch (error) {
                alert('Backend connection failed! Make sure Flask is running: python app.py');
                updateApiBtn.textContent = 'Update';
            } finally {
                updateApiBtn.disabled = false;
            }
        });

        // Update Gemini API Key
        const updateGeminiApiBtn = document.getElementById('updateGeminiApiBtn');
        const geminiApiSuccessMsg = document.getElementById('geminiApiSuccessMsg');

        updateGeminiApiBtn.addEventListener('click', async function () {
            const geminiApiKey = document.getElementById('geminiApiKey').value.trim();

            if (!geminiApiKey) {
                alert('Please enter a Gemini API key');
                return;
            }

            updateGeminiApiBtn.disabled = true;
            updateGeminiApiBtn.textContent = 'Updating...';

            try {
                const response = await fetch('/update-config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        field: 'GEMINI_API_KEY',
                        value: geminiApiKey
                    })
                });

                const data = await response.json();

                if (data.success) {
                    updateGeminiApiBtn.classList.add('success');
                    updateGeminiApiBtn.textContent = 'Saved';
                    geminiApiSuccessMsg.classList.add('show');

                    setTimeout(() => {
                        updateGeminiApiBtn.classList.remove('success');
                        updateGeminiApiBtn.textContent = 'Update';
                        geminiApiSuccessMsg.classList.remove('show');
                    }, 3000);
                } else {
                    alert('Error: ' + data.message);
                    updateGeminiApiBtn.textContent = 'Update';
                }
            } catch (error) {
                alert('Backend connection failed! Make sure Flask is running: python app.py');
                updateGeminiApiBtn.textContent = 'Update';
            } finally {
                updateGeminiApiBtn.disabled = false;
            }
        });

        // Start Bot
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const statusBox = document.getElementById('statusBox');
        const statusIcon = document.getElementById('statusIcon');
        const statusText = document.getElementById('statusText');
        const logContainer = document.getElementById('logContainer');

        let isRunning = false;

        startBtn.addEventListener('click', async function (e) {
            e.preventDefault();
            console.log('Start button clicked');

            if (isRunning) {
                console.log('Bot already running');
                return;
            }

            const storeUrl = document.getElementById('storeUrl').value.trim();
            const apiKey = document.getElementById('apiKey').value.trim();
            const geminiApiKey = document.getElementById('geminiApiKey').value.trim();
            const imageProvider = document.getElementById('imageProvider').value;

            console.log('Configuration:', { storeUrl, apiKey: '***', geminiApiKey: '***', imageProvider });

            if (!storeUrl || !apiKey) {
                alert('Please set Store URL and API Key first');
                return;
            }

            // Validate provider-specific API keys
            if (imageProvider === 'gemini' && !geminiApiKey) {
                alert('Please provide a Gemini API Key for image generation, or select a different provider');
                return;
            }

            const config = {
                storeUrl: storeUrl,
                apiKey: apiKey,
                geminiApiKey: geminiApiKey,
                imageProvider: imageProvider,
                headless: true  // Always headless
            };

            console.log('Sending config to backend:', config);

            // Show status box
            statusBox.classList.add('active', 'running');
            statusIcon.classList.add('running');
            statusText.textContent = 'Bot Running...';

            // Update button states
            startBtn.disabled = true;
            stopBtn.disabled = false;
            isRunning = true;

            // Add log entry
            addLog('info', 'Starting bot with configuration...');
            addLog('info', `Store: ${config.storeUrl}`);
            addLog('info', `Image Provider: ${config.imageProvider === 'none' ? 'Disabled' : config.imageProvider.toUpperCase()}`);
            addLog('info', 'Headless: Always enabled (background mode)');

            try {
                console.log('Fetching /start-bot endpoint...');
                const response = await fetch('/start-bot', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(config)
                });

                console.log('Response status:', response.status);
                const data = await response.json();
                console.log('Response data:', data);

                if (data.success) {
                    addLog('success', 'Bot started successfully!');
                    pollBotStatus();
                } else {
                    addLog('error', `Error: ${data.message}`);
                    resetButtons();
                }
            } catch (error) {
                console.error('Fetch error:', error);
                addLog('error', `Connection error: ${error.message}`);
                addLog('warning', 'Make sure Flask backend is running!');
                resetButtons();
            }
        });

        stopBtn.addEventListener('click', async function () {
            addLog('warning', 'Stopping bot...');

            try {
                const response = await fetch('/stop-bot', {
                    method: 'POST'
                });

                const data = await response.json();
                addLog('success', 'Bot stopped successfully');
                resetButtons();
            } catch (error) {
                addLog('error', `Error stopping bot: ${error.message}`);
            }
        });

        function addLog(type, message) {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function resetButtons() {
            startBtn.disabled = false;
            stopBtn.disabled = true;
            isRunning = false;
            statusBox.classList.remove('running');
            statusIcon.classList.remove('running');
            statusText.textContent = 'Stopped';
        }

        async function pollBotStatus() {
            if (!isRunning) return;

            try {
                const response = await fetch('/bot-status');
                const data = await response.json();

                document.getElementById('statProducts').textContent = data.productsProcessed || 0;
                document.getElementById('statReviews').textContent = data.reviewsPosted || 0;

                if (data.logs && data.logs.length > 0) {
                    data.logs.forEach(log => {
                        addLog(log.type, log.message);
                    });
                }

                if (data.running) {
                    setTimeout(pollBotStatus, 2000);
                } else {
                    addLog('success', 'Bot completed all tasks!');
                    resetButtons();
                }
            } catch (error) {
                console.error('Polling error:', error);
                setTimeout(pollBotStatus, 5000);
            }
        }

        // Test button on page load
        console.log('Page loaded, Start button:', startBtn);

        // Clear Progress button
        document.getElementById('clearProgressBtn').addEventListener('click', async function () {
            if (!confirm('Are you sure you want to clear all progress? The bot will start from scratch on the next run.')) {
                return;
            }

            try {
                const response = await fetch('/clear-progress', {
                    method: 'POST'
                });

                const data = await response.json();

                if (data.success) {
                    alert('‚úÖ Progress cleared! The bot will start fresh on the next run.');
                    addLog('info', 'üóëÔ∏è Progress cleared - ready for fresh start');
                    // Update button back to Start Bot
                    updateStartButton(false);
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                alert('Error clearing progress: ' + error.message);
            }
        });

        // Function to check progress and update button
        async function checkProgressAndUpdateButton() {
            try {
                const response = await fetch('/check-progress');
                const data = await response.json();

                updateStartButton(data.hasProgress, data);
            } catch (error) {
                console.log('Could not check progress:', error);
            }
        }

        // Update start button based on progress
        function updateStartButton(hasProgress, progressData = null) {
            const btnIcon = document.getElementById('startBtnIcon');
            const btnText = document.getElementById('startBtnText');

            if (hasProgress) {
                btnIcon.textContent = '‚ñ∂Ô∏è';
                btnText.textContent = 'Resume Bot';

                // Show resume info if we have progress data
                if (progressData && progressData.currentProduct) {
                    const cp = progressData.currentProduct;
                    console.log(`Resume info: ${cp.reviewsCompleted}/${cp.totalReviews} reviews done`);
                }
            } else {
                btnIcon.textContent = 'üöÄ';
                btnText.textContent = 'Start Bot';
            }
        }

        // Check progress on page load
        checkProgressAndUpdateButton();
    </script>
</body>

</html>